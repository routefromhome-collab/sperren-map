<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_d073e8fb16a3c98fbe9c7daf827deb56 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>

            <style>html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            </style>

            <style>#map {
                position:absolute;
                top:0;
                bottom:0;
                right:0;
                left:0;
                }
            </style>

            <script>
                L_NO_TOUCH = false;
                L_DISABLE_3D = false;
            </script>

        
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.css"/>
</head>
<body>
    
    
            <div class="folium-map" id="map_d073e8fb16a3c98fbe9c7daf827deb56" ></div>
        

        <script>
        document.addEventListener("DOMContentLoaded", function() {
            try {
                // MAP placeholder
                var MAP = map_d073e8fb16a3c98fbe9c7daf827deb56;
                if (!MAP) {
                    // fallback: найти любой объект типа L.Map в window
                    MAP = Object.values(window).find(function(v){ return v && v._leaflet_id && (v instanceof L.Map); });
                }
                if (!MAP) {
                    console.error("Map object not found");
                    return;
                }

                var STREETS = JSON.parse('[{"name": "Aprather Weg", "coords": [[51.2692637, 7.0807375], [51.2692837, 7.0825705], [51.2708353, 7.0746958], [51.2705487, 7.0753073], [51.2702396, 7.075885], [51.2699758, 7.076367], [51.2698458, 7.0766406], [51.269745, 7.0769048], [51.2695595, 7.0774796], [51.2694493, 7.0779001], [51.2693619, 7.0783082], [51.2692703, 7.0788609], [51.2692238, 7.079267], [51.2692135, 7.0794919], [51.2692155, 7.0797709], [51.269246, 7.0802562], [51.2692637, 7.0807375], [51.2708693, 7.1001236], [51.2708583, 7.1005596], [51.2708283, 7.1009785], [51.2707948, 7.101171], [51.2707607, 7.1013371], [51.270709, 7.1015508], [51.2705622, 7.1020213], [51.2705036, 7.1022001], [51.2700378, 7.1035711], [51.2699586, 7.1038431], [51.2698902, 7.1041189], [51.2698557, 7.1043176], [51.2698447, 7.1044038], [51.2698357, 7.1044513], [51.269826, 7.1045278], [51.2710535, 7.0968074], [51.2709743, 7.097093], [51.2709094, 7.0974304], [51.2708825, 7.0979079], [51.2708753, 7.0984301], [51.2708802, 7.099356], [51.2708693, 7.1001236], [51.2713353, 7.0958007], [51.2710535, 7.0968074], [51.2713353, 7.0958007], [51.2714069, 7.0955346], [51.2715638, 7.0950032], [51.2716104, 7.0948246], [51.2716445, 7.094575], [51.2716335, 7.0943667], [51.2715999, 7.0942101], [51.2711803, 7.0927987], [51.2710963, 7.0924132], [51.2710107, 7.0919177], [51.2709818, 7.0913277], [51.2709309, 7.0901081], [51.2709269, 7.0893026], [51.2709169, 7.0888409], [51.2708953, 7.0879859], [51.2708499, 7.0875764], [51.2707656, 7.0871647], [51.2706469, 7.0867362], [51.2706253, 7.0866721], [51.2704375, 7.0861036], [51.2698906, 7.0844855], [51.2693031, 7.0827862], [51.2692837, 7.0825705], [51.269826, 7.1045278], [51.2698193, 7.1046905], [51.2698435, 7.1048442], [51.2700535, 7.1055778], [51.2701871, 7.1060313], [51.2701871, 7.1060313], [51.2702868, 7.1063816], [51.2703363, 7.1065975], [51.2703532, 7.1066956], [51.2703655, 7.1067947], [51.2703673, 7.1068811], [51.2703673, 7.1068811], [51.2703541, 7.1069795], [51.2702143, 7.1075027]]}]');

                function haversine_m(a,b) {
                    var R = 6371000;
                    var φ1 = a[0]*Math.PI/180, φ2 = b[0]*Math.PI/180;
                    var dφ = (b[0]-a[0])*Math.PI/180;
                    var dλ = (b[1]-a[1])*Math.PI/180;
                    var sa = Math.sin(dφ/2)*Math.sin(dφ/2) + Math.cos(φ1)*Math.cos(φ2)*Math.sin(dλ/2)*Math.sin(dλ/2);
                    var c = 2*Math.atan2(Math.sqrt(sa), Math.sqrt(1-sa));
                    return R*c;
                }

                function closestPointOnSegment(p, a, b) {
                    var latScale = Math.cos(p[0]*Math.PI/180);
                    var ax=a[0], ay=a[1]*latScale;
                    var bx=b[0], by=b[1]*latScale;
                    var px=p[0], py=p[1]*latScale;
                    var vx=bx-ax, vy=by-ay;
                    var wx=px-ax, wy=py-ay;
                    var vlen2 = vx*vx + vy*vy;
                    if (!vlen2) return a.slice();
                    var t = Math.max(0, Math.min(1, (vx*wx + vy*wy)/vlen2));
                    var cx = ax + vx*t, cy = ay + vy*t;
                    return [cx, cy/latScale];
                }

                function nearestPointOnPolyline(p, coords) {
                    if (!coords || coords.length === 0) return null;
                    if (coords.length === 1) return {point: coords[0], dist: haversine_m(p, coords[0])};
                    var best = null, bestDist = Infinity;
                    for (var i=0;i<coords.length-1;i++){
                        var a = coords[i], b = coords[i+1];
                        var c = closestPointOnSegment(p, a, b);
                        var d = haversine_m(p, c);
                        if (d < bestDist) { bestDist = d; best = {point: c, dist: d}; }
                    }
                    return best;
                }

                function showNearestStreet() {
                    if (!navigator.geolocation) { alert("Геолокация не поддерживается"); return; }
                    navigator.geolocation.getCurrentPosition(function(pos) {
                        var user = [pos.coords.latitude, pos.coords.longitude];
                        var bestStreet = null, bestInfo = null;

                        for (var si=0; si<STREETS.length; si++) {
                            var st = STREETS[si];
                            var coords = st.coords || [];
                            if (!coords || coords.length === 0) continue;
                            // flatten segments if needed
                            var flat = (Array.isArray(coords[0]) && Array.isArray(coords[0][0])) ? coords.flat() : coords;
                            if (flat.length === 0) continue;
                            var info = nearestPointOnPolyline(user, flat);
                            if (!info) continue;
                            if (!bestInfo || info.dist < bestInfo.dist) {
                                bestInfo = info;
                                bestStreet = {name: st.name, coords: flat};
                            }
                        }

                        if (!bestStreet || !bestInfo) { alert("Не удалось найти ближайшую улицу"); return; }

                        var nearPt = bestInfo.point;
                        var meters = Math.round(bestInfo.dist);
                        var walkMin = Math.max(1, Math.round((meters/1000)/5*60)); // 5 km/h

                        // очистка предыдущих маркеров
                        if (!window.__sperren_marks) window.__sperren_marks = [];
                        window.__sperren_marks.forEach(function(l){ try{ MAP.removeLayer(l); } catch(e){} });
                        window.__sperren_marks = [];

                        // flyTo и открытие popup после небольшого таймаута, чтобы карта успела центрироваться
                        MAP.flyTo(nearPt, 17);
                        setTimeout(function(){
                            var m = L.marker(nearPt).addTo(MAP);
                            m.bindPopup(
                                "<div style='font-family:Arial,Helvetica,sans-serif; font-size:14px;'><b>Ближайшая улица:</b> " + (bestStreet.name || "—") +
                                "<br><b>Расстояние:</b> " + meters + " м" +
                                "<br><b>Пешком:</b> примерно " + walkMin + " мин</div>"
                            ).openPopup();
                            window.__sperren_marks.push(m);
                        }, 600);

                        // маркер пользователя (не открываем popup чтобы не закрыть предыдущий)
                        var um = L.circleMarker(user, {radius:6, color:'#333', fillColor:'#fff', weight:2}).addTo(MAP);
                        um.bindPopup("Вы здесь");
                        window.__sperren_marks.push(um);

                    }, function(err) {
                        alert("Ошибка геопозиции: " + err.message);
                    }, {enableHighAccuracy:true, timeout:10000, maximumAge:0});
                }

                // --- Кнопка (с небольшим стилем) ---
                var btn = document.createElement("button");
                btn.textContent = "Показать ближайшую улицу ко мне";
                btn.style.position = "absolute";
                btn.style.top = "12px";
                btn.style.left = "50%";
                btn.style.transform = "translateX(-50%)";
                btn.style.zIndex = 1000;
                btn.style.padding = "8px 14px";
                btn.style.background = "#ffffff";
                btn.style.border = "1px solid rgba(0,0,0,0.15)";
                btn.style.borderRadius = "8px";
                btn.style.boxShadow = "0 2px 6px rgba(0,0,0,0.08)";
                btn.style.fontFamily = "Arial, Helvetica, sans-serif";
                btn.style.cursor = "pointer";
                btn.onclick = showNearestStreet;
                document.body.appendChild(btn);

                // ==== Плавающий рекламный блок (креативный дизайн) ====
                var adWrap = document.createElement("div");
                adWrap.id = "__sperren_ad";
                adWrap.style.position = "fixed";
                adWrap.style.bottom = "22px";
                adWrap.style.right = "22px";
                adWrap.style.zIndex = 99999;
                adWrap.style.width = "260px";
                adWrap.style.maxWidth = "calc(100% - 44px)";
                adWrap.style.boxSizing = "border-box";
                adWrap.style.fontFamily = "Inter, Arial, Helvetica, sans-serif";
                adWrap.style.transition = "transform 0.24s ease, opacity 0.2s ease";
                adWrap.style.boxShadow = "0 10px 30px rgba(0,0,0,0.12)";
                adWrap.style.borderRadius = "12px";
                adWrap.style.overflow = "hidden";
                adWrap.style.background = "linear-gradient(180deg,#ffffff,#fbfbff)";

                // inner content
                var adInner = document.createElement("div");
                adInner.style.padding = "12px";
                adInner.style.display = "flex";
                adInner.style.gap = "10px";
                adInner.style.alignItems = "center";

                // left: logo / icon
                var adIcon = document.createElement("div");
                adIcon.style.width = "48px";
                adIcon.style.height = "48px";
                adIcon.style.borderRadius = "10px";
                adIcon.style.flex = "0 0 48px";
                adIcon.style.display = "flex";
                adIcon.style.alignItems = "center";
                adIcon.style.justifyContent = "center";
                adIcon.style.background = "linear-gradient(135deg,#ffcc33,#ff6a00)";
                adIcon.style.color = "#fff";
                adIcon.style.fontWeight = "700";
                adIcon.style.fontSize = "20px";
                adIcon.textContent = "SZ"; // Schwebezeit

                // center: text
                var adTextWrap = document.createElement("div");
                adTextWrap.style.flex = "1 1 auto";
                adTextWrap.innerHTML = "<div style='font-size:15px; font-weight:700; color:#111; line-height:1.05;'>⚡ Карта от Schwebezeit</div>" +
                                       "<div style='font-size:13px; color:#444; margin-top:4px;'>Лучший канал — подпишись в Telegram</div>";

                // right: CTA
                var adCTA = document.createElement("div");
                adCTA.style.flex = "0 0 auto";
                var ctaBtn = document.createElement("button");
                ctaBtn.textContent = "Перейти";
                ctaBtn.style.background = "#1d72ff";
                ctaBtn.style.color = "#fff";
                ctaBtn.style.border = "none";
                ctaBtn.style.padding = "8px 10px";
                ctaBtn.style.borderRadius = "8px";
                ctaBtn.style.cursor = "pointer";
                ctaBtn.style.fontWeight = "700";
                ctaBtn.onclick = function(e){ e.stopPropagation(); window.open('https://t.me/schwebezeit','_blank'); };
                adCTA.appendChild(ctaBtn);

                adInner.appendChild(adIcon);
                adInner.appendChild(adTextWrap);
                adInner.appendChild(adCTA);

                adWrap.appendChild(adInner);
                adWrap.appendChild(closeBtn);

                // small footer (powered by)
                var adFooter = document.createElement("div");
                adFooter.style.padding = "8px 12px";
                adFooter.style.fontSize = "11px";
                adFooter.style.color = "#666";
                adFooter.style.background = "rgba(0,0,0,0.02)";
                adFooter.style.textAlign = "center";
                adFooter.innerHTML = "Поддержка проекта — <a href='https://t.me/schwebezeit' target='_blank' style='color:#1d72ff;text-decoration:none;'>Schwebezeit</a>";
                adFooter.onclick = function(e){ e.stopPropagation(); window.open('https://t.me/schwebezeit','_blank'); };

                // append footer to wrap
                adWrap.appendChild(adFooter);

                // click on whole card opens channel
                adWrap.onclick = function(){ window.open('https://t.me/schwebezeit','_blank'); };

                document.body.appendChild(adWrap);
                // === end ad block ===

            } catch (err) {
                console.error("MAP script init error:", err);
            }
        });
        </script>
        </body>
<script>
    
    
            var map_d073e8fb16a3c98fbe9c7daf827deb56 = L.map(
                "map_d073e8fb16a3c98fbe9c7daf827deb56",
                {
                    center: [51.2562, 7.1508],
                    crs: L.CRS.EPSG3857,
                    ...{
  "zoom": 12,
  "zoomControl": true,
  "preferCanvas": false,
}

                }
            );

            

        
    
            var tile_layer_035d7141264d0e4d236af3a69d5a28e8 = L.tileLayer(
                "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                {
  "minZoom": 0,
  "maxZoom": 19,
  "maxNativeZoom": 19,
  "noWrap": false,
  "attribution": "\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors",
  "subdomains": "abc",
  "detectRetina": false,
  "tms": false,
  "opacity": 1,
}

            );
        
    
            tile_layer_035d7141264d0e4d236af3a69d5a28e8.addTo(map_d073e8fb16a3c98fbe9c7daf827deb56);
        
    
            var marker_e999b97164c6703e740cb3a024d8a57a = L.marker(
                [51.2710675, 7.1074401],
                {
}
            ).addTo(map_d073e8fb16a3c98fbe9c7daf827deb56);
        
    
        var popup_d8a6efcc62ea41a0cace7a1809380e2e = L.popup({
  "maxWidth": "100%",
});

        
            
                var html_32eaef3819a6f40dbdcec61c742561ee = $(`<div id="html_32eaef3819a6f40dbdcec61c742561ee" style="width: 100.0%; height: 100.0%;">Aprather Weg 12A</div>`)[0];
                popup_d8a6efcc62ea41a0cace7a1809380e2e.setContent(html_32eaef3819a6f40dbdcec61c742561ee);
            
        

        marker_e999b97164c6703e740cb3a024d8a57a.bindPopup(popup_d8a6efcc62ea41a0cace7a1809380e2e)
        ;

        
    
    
            var marker_b9a072c1ce83ec4cb981d141027a08df = L.marker(
                [51.2537035, 7.1002346],
                {
}
            ).addTo(map_d073e8fb16a3c98fbe9c7daf827deb56);
        
    
        var popup_4add553ce50e826a780c55da478be74a = L.popup({
  "maxWidth": "100%",
});

        
            
                var html_dd425d463bd55a7630eacad31579317b = $(`<div id="html_dd425d463bd55a7630eacad31579317b" style="width: 100.0%; height: 100.0%;">Benrather Str</div>`)[0];
                popup_4add553ce50e826a780c55da478be74a.setContent(html_dd425d463bd55a7630eacad31579317b);
            
        

        marker_b9a072c1ce83ec4cb981d141027a08df.bindPopup(popup_4add553ce50e826a780c55da478be74a)
        ;

        
    
    
            map_d073e8fb16a3c98fbe9c7daf827deb56.fitBounds(
                [[51.2710675, 7.1074401], [51.2537035, 7.1002346]],
                {}
            );
        
    
            var locate_control_1475ff26e2d84c975e6274bd4459e2f8 = L.control.locate(
                {}
            ).addTo(map_d073e8fb16a3c98fbe9c7daf827deb56);
            
        
</script>
</html>